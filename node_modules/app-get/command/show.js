'use strict';

const got = require('got');
const pretty = require('prettyjson');
const assert = require('../common/assert');
const logger = require('../common/logger');

const show = (pkgs, cli) => {
  if (pkgs == null || pkgs.length === 0) {
    cli.showHelp()
  } else {
    assert.must(pkgs.length == 1, 'commond <show> only support one package name for now');

    pkgs.forEach(pkg=>{
      got(`http://api.findapp.me/search?pkg=${pkg}`, {json:true})
        .then(data => {
          const body = data.body;
          if (body.status === 0 && body.data != null && body.data.length != 0) {
            body.data.forEach(each=>logger.info(pretty.render(each, {
              keysColor: 'red',
              dashColor: 'magenta',
              stringColor: 'white'
            })));
          } else if (body.status !== 0 && body.message != null) {
            logger.info(`Try to find info of package ${pkg} failed: ${body.message}`)
          } else if (body.data == null || body.data.length === 0) {
            logger.info(`Info for package ${pkg} not found.`)
          } else {
            logger.err(body);
            logger.issue()
          }
        })
    })
  }
};

module.exports = {
  show
};
